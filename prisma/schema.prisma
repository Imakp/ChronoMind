generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  accounts      Account[]
  sessions      Session[]
  years         Year[]
  tags          Tag[]
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

model Year {
  id                   String                @id @default(cuid())
  year                 Int
  userId               String
  user                 User                  @relation(fields: [userId], references: [id])
  dailyLogs            DailyLog[]
  quarterlyReflections QuarterlyReflection[]
  goals                Goal[]
  genres               Genre[]
  lessons              Lesson[]
  creativeNotes        CreativeNote[]

  @@unique([userId, year])
  @@index([userId])
  @@index([year])
}

model DailyLog {
  id         String      @id @default(cuid())
  date       DateTime
  content    Json?
  hasContent Boolean     @default(false)
  yearId     String
  year       Year        @relation(fields: [yearId], references: [id])
  highlights Highlight[]

  @@unique([yearId, date])
  @@index([yearId])
  @@index([date])
  @@index([hasContent])
}

model QuarterlyReflection {
  id         String      @id @default(cuid())
  quarter    Int
  content    Json?
  yearId     String
  year       Year        @relation(fields: [yearId], references: [id])
  highlights Highlight[]

  @@unique([yearId, quarter])
  @@index([yearId])
}

model Goal {
  id          String      @id @default(cuid())
  title       String
  description Json?
  percentage  Float       @default(0)
  yearId      String
  year        Year        @relation(fields: [yearId], references: [id])
  tasks       Task[]
  highlights  Highlight[]

  @@index([yearId])
}

model Task {
  id          String      @id @default(cuid())
  title       String
  description Json?
  percentage  Float       @default(0)
  goalId      String
  goal        Goal        @relation(fields: [goalId], references: [id])
  subtasks    SubTask[]
  highlights  Highlight[]

  @@index([goalId])
}

model SubTask {
  id         String      @id @default(cuid())
  title      String
  isComplete Boolean     @default(false)
  taskId     String
  task       Task        @relation(fields: [taskId], references: [id])
  highlights Highlight[]

  @@index([taskId])
}

model Genre {
  id     String @id @default(cuid())
  name   String
  yearId String
  year   Year   @relation(fields: [yearId], references: [id])
  books  Book[]

  @@index([yearId])
}

model Book {
  id       String    @id @default(cuid())
  title    String
  genreId  String
  genre    Genre     @relation(fields: [genreId], references: [id])
  chapters Chapter[]

  @@index([genreId])
}

model Chapter {
  id         String      @id @default(cuid())
  title      String
  content    Json?
  bookId     String
  book       Book        @relation(fields: [bookId], references: [id])
  highlights Highlight[]

  @@index([bookId])
}

model Lesson {
  id         String      @id @default(cuid())
  title      String
  content    Json?
  preview    String?     @default("")
  createdAt  DateTime    @default(now())
  yearId     String
  year       Year        @relation(fields: [yearId], references: [id])
  highlights Highlight[]

  @@index([yearId])
  @@index([createdAt])
}

model CreativeNote {
  id         String      @id @default(cuid())
  content    Json?
  preview    String?     @default("")
  createdAt  DateTime    @default(now())
  yearId     String
  year       Year        @relation(fields: [yearId], references: [id])
  highlights Highlight[]

  @@index([yearId])
  @@index([createdAt])
}

model Tag {
  id         String      @id @default(cuid())
  name       String
  userId     String
  user       User        @relation(fields: [userId], references: [id])
  highlights Highlight[]

  @@unique([userId, name])
  @@index([userId])
  @@index([name])
}

model Highlight {
  id                    String               @id @default(cuid())
  tiptapId              String               @unique
  text                  String
  startOffset           Int
  endOffset             Int
  createdAt             DateTime             @default(now())
  dailyLogId            String?
  quarterlyReflectionId String?
  goalId                String?
  taskId                String?
  subtaskId             String?
  chapterId             String?
  lessonId              String?
  creativeNoteId        String?
  dailyLog              DailyLog?            @relation(fields: [dailyLogId], references: [id])
  quarterlyReflection   QuarterlyReflection? @relation(fields: [quarterlyReflectionId], references: [id])
  goal                  Goal?                @relation(fields: [goalId], references: [id])
  task                  Task?                @relation(fields: [taskId], references: [id])
  subtask               SubTask?             @relation(fields: [subtaskId], references: [id])
  chapter               Chapter?             @relation(fields: [chapterId], references: [id])
  lesson                Lesson?              @relation(fields: [lessonId], references: [id])
  creativeNote          CreativeNote?        @relation(fields: [creativeNoteId], references: [id])
  tags                  Tag[]

  @@index([dailyLogId])
  @@index([quarterlyReflectionId])
  @@index([goalId])
  @@index([taskId])
  @@index([subtaskId])
  @@index([chapterId])
  @@index([lessonId])
  @@index([creativeNoteId])
  @@index([createdAt])
}

model HighlightToTag {
  A String
  B String

  @@id([A, B], map: "_HighlightToTag_AB_pkey")
  @@index([B], map: "_HighlightToTag_B_index")
  @@map("_HighlightToTag")
}
